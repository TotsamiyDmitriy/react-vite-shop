import React from 'react';
import '../../scss/components/profile.scss';
import { NavLink } from 'react-router-dom';
import useAuth from '../../hooks/useAuth';
import { Popover, Avatar } from '@mui/material';
import { PopupAccount } from '.';
import stringAvatar from '../../utils/avatar';

interface ProfileProps {
  burgerState?: boolean;
  onClickLink: () => void;
  className: string;
  handlerModal: () => void;
}

const Profile: React.FC<ProfileProps> = ({ className, handlerModal, onClickLink }) => {
  const { isAuth, email } = useAuth();

  const [anchorEl, setAnchorEl] = React.useState<HTMLDivElement | null>(null);

  const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {
    event.preventDefault();
    setAnchorEl(event.currentTarget);
  };

  const handleClose = () => {
    setAnchorEl(null);
  };

  React.useEffect(() => {
    setAnchorEl(null);
  }, [isAuth]);

  return (
    <div className={className}>
      {isAuth === true ? (
        <NavLink onClick={onClickLink} to={'/favourite/'}>
          <svg
            width="27"
            height="23"
            viewBox="0 0 27 23"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M25.9698 5.66386C25.8236 5.09145 25.5978 4.54236 25.2992 4.0326C25.0123 3.50232 24.6455 3.01937 24.2117 2.60073C23.5827 1.97385 22.8378 1.47522 22.0186 1.1326C20.3695 0.455798 18.5202 0.455798 16.8711 1.1326C16.0967 1.46037 15.3853 1.92036 14.7686 2.49198L14.6779 2.60073L13.4998 3.77885L12.3217 2.60073L12.2311 2.49198C11.6144 1.92036 10.9029 1.46037 10.1286 1.1326C8.47947 0.455798 6.63016 0.455798 4.98106 1.1326C4.16179 1.47522 3.41693 1.97385 2.78794 2.60073C1.92766 3.4378 1.31868 4.49881 1.02982 5.66386C0.876143 6.25549 0.802983 6.86516 0.812316 7.47636C0.812316 8.05092 0.884816 8.62367 1.02982 9.1801C1.18176 9.74206 1.40084 10.2837 1.68232 10.7932C1.9863 11.3171 2.35805 11.7985 2.78794 12.2251L13.4998 22.937L24.2117 12.2251C24.6412 11.8028 25.0092 11.3189 25.2992 10.7932C25.8879 9.78748 26.1947 8.6417 26.1873 7.47636C26.1967 6.86515 26.1236 6.25548 25.9698 5.66386ZM24.1573 8.61823C23.9402 9.44639 23.5089 10.2028 22.9067 10.8114L13.4636 20.2364L4.02044 10.8114C3.71272 10.5014 3.44482 10.1544 3.22294 9.77823C3.01415 9.40608 2.8499 9.01065 2.73357 8.6001C2.64069 8.18961 2.59208 7.77034 2.58857 7.34948C2.59102 6.91659 2.63963 6.48519 2.73357 6.0626C2.84649 5.65088 3.01091 5.25504 3.22294 4.88448C3.44044 4.50385 3.70869 4.15948 4.02044 3.85135C4.48606 3.39197 5.03308 3.02319 5.63356 2.76385C6.84361 2.27978 8.19352 2.27978 9.40356 2.76385C10.0017 3.01217 10.5418 3.37648 10.9986 3.83323L13.4636 6.31635L15.9286 3.83323C16.385 3.37567 16.9269 3.01232 17.5236 2.76385C18.7336 2.27978 20.0835 2.27978 21.2936 2.76385C21.8935 3.02304 22.4409 3.39279 22.9067 3.85135C23.2221 4.15042 23.4867 4.49842 23.6861 4.88448C24.1059 5.62482 24.3246 6.46215 24.3204 7.31323C24.3451 7.75117 24.3085 8.19041 24.2117 8.61823H24.1573Z"
              fill="black"
            />
          </svg>
        </NavLink>
      ) : (
        <a onClick={handlerModal}>
          <svg
            width="27"
            height="23"
            viewBox="0 0 27 23"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M25.9698 5.66386C25.8236 5.09145 25.5978 4.54236 25.2992 4.0326C25.0123 3.50232 24.6455 3.01937 24.2117 2.60073C23.5827 1.97385 22.8378 1.47522 22.0186 1.1326C20.3695 0.455798 18.5202 0.455798 16.8711 1.1326C16.0967 1.46037 15.3853 1.92036 14.7686 2.49198L14.6779 2.60073L13.4998 3.77885L12.3217 2.60073L12.2311 2.49198C11.6144 1.92036 10.9029 1.46037 10.1286 1.1326C8.47947 0.455798 6.63016 0.455798 4.98106 1.1326C4.16179 1.47522 3.41693 1.97385 2.78794 2.60073C1.92766 3.4378 1.31868 4.49881 1.02982 5.66386C0.876143 6.25549 0.802983 6.86516 0.812316 7.47636C0.812316 8.05092 0.884816 8.62367 1.02982 9.1801C1.18176 9.74206 1.40084 10.2837 1.68232 10.7932C1.9863 11.3171 2.35805 11.7985 2.78794 12.2251L13.4998 22.937L24.2117 12.2251C24.6412 11.8028 25.0092 11.3189 25.2992 10.7932C25.8879 9.78748 26.1947 8.6417 26.1873 7.47636C26.1967 6.86515 26.1236 6.25548 25.9698 5.66386ZM24.1573 8.61823C23.9402 9.44639 23.5089 10.2028 22.9067 10.8114L13.4636 20.2364L4.02044 10.8114C3.71272 10.5014 3.44482 10.1544 3.22294 9.77823C3.01415 9.40608 2.8499 9.01065 2.73357 8.6001C2.64069 8.18961 2.59208 7.77034 2.58857 7.34948C2.59102 6.91659 2.63963 6.48519 2.73357 6.0626C2.84649 5.65088 3.01091 5.25504 3.22294 4.88448C3.44044 4.50385 3.70869 4.15948 4.02044 3.85135C4.48606 3.39197 5.03308 3.02319 5.63356 2.76385C6.84361 2.27978 8.19352 2.27978 9.40356 2.76385C10.0017 3.01217 10.5418 3.37648 10.9986 3.83323L13.4636 6.31635L15.9286 3.83323C16.385 3.37567 16.9269 3.01232 17.5236 2.76385C18.7336 2.27978 20.0835 2.27978 21.2936 2.76385C21.8935 3.02304 22.4409 3.39279 22.9067 3.85135C23.2221 4.15042 23.4867 4.49842 23.6861 4.88448C24.1059 5.62482 24.3246 6.46215 24.3204 7.31323C24.3451 7.75117 24.3085 8.19041 24.2117 8.61823H24.1573Z"
              fill="black"
            />
          </svg>
        </a>
      )}
      <NavLink onClick={onClickLink} to={'/cart/'}>
        <svg
          width="25"
          height="19"
          viewBox="0 0 25 19"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M24.648 2.32567C24.573 2.23327 24.4785 2.15861 24.3713 2.10708C24.264 2.05554 24.1467 2.0284 24.0277 2.02762H7.25605L7.77967 3.63873H22.9724L20.8216 13.3054H8.73828L5.05689 1.64901C5.01707 1.52532 4.94792 1.4131 4.85534 1.32193C4.76276 1.23075 4.6495 1.16332 4.52522 1.1254L1.22244 0.110396C1.12089 0.0791886 1.01418 0.0682899 0.908413 0.0783218C0.802645 0.0883538 0.699889 0.11912 0.606011 0.168864C0.416417 0.269326 0.274497 0.44099 0.211471 0.64609C0.148445 0.851191 0.169477 1.07293 0.269939 1.26252C0.370401 1.45212 0.542065 1.59404 0.747166 1.65706L3.63911 2.54317L7.33661 14.2237L6.0155 15.3032L5.91078 15.4079C5.58399 15.7845 5.39877 16.2632 5.387 16.7617C5.37524 17.2602 5.53768 17.7471 5.84633 18.1387C6.06589 18.4057 6.3449 18.6177 6.66102 18.7575C6.97715 18.8974 7.32162 18.9614 7.66689 18.9443H21.1116C21.3253 18.9443 21.5302 18.8594 21.6812 18.7083C21.8323 18.5573 21.9172 18.3524 21.9172 18.1387C21.9172 17.9251 21.8323 17.7202 21.6812 17.5691C21.5302 17.418 21.3253 17.3332 21.1116 17.3332H7.538C7.44524 17.33 7.35486 17.303 7.2756 17.2547C7.19633 17.2064 7.13086 17.1385 7.08551 17.0575C7.04016 16.9765 7.01646 16.8852 7.0167 16.7924C7.01694 16.6995 7.04112 16.6084 7.08689 16.5276L9.02828 14.9165H21.4661C21.6523 14.9211 21.8343 14.8609 21.9812 14.7464C22.1281 14.6318 22.2307 14.4699 22.2716 14.2882L24.8252 3.0104C24.8497 2.8903 24.8465 2.7662 24.8158 2.64754C24.7851 2.52889 24.7277 2.4188 24.648 2.32567Z"
            fill="#272727"
          />
        </svg>
      </NavLink>
      {isAuth === true && email ? (
        <>
          <div onClick={handleClick} className="person">
            <Avatar {...stringAvatar(email)}></Avatar>
          </div>
          <Popover
            open={!!anchorEl}
            anchorEl={anchorEl}
            onClose={handleClose}
            anchorOrigin={{
              vertical: 'top',
              horizontal: 'right',
            }}
            transformOrigin={{
              vertical: 'top',
              horizontal: 'right',
            }}>
            <PopupAccount></PopupAccount>
          </Popover>
        </>
      ) : (
        <div onClick={handlerModal} className="person">
          Sign In
        </div>
      )}
    </div>
  );
};

export default Profile;
